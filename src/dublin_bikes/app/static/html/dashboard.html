<html>
<head>
  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
</head>
<body>
<div class="container-fluid">
<div class="row">
<div class="col-md-12"><h1>Dashboard</h1></div></div>
<div class="row" id="dayBar"></div>
<div class="row">
<div class = "col-md-2" stlye="overflow-y:scroll;" id="standsList"></div>

<div class = "col-md-10">
<canvas id="chart" width="800" height="450"></canvas>
</div>
</div>
</div>


</body>

<script>
var currentStand = 1
var currentDay = 1
//basically we just want 24 points right?

function makeTimeLabels(){
  arr = []
  for(var i=0; i<24; i++){
if (i<10){
arr.push('0'+i.toString()+':00')
}
else{
arr.push(i.toString()+':00')

}
return arr
  }

}

function getStaticLocations(){
console.log('getting static data')
var xmlhttp = new XMLHttpRequest();
//get all data for drawing map markers
  xmlhttp.onreadystatechange = function() {

    if (this.readyState == 4 && this.status == 200) {

          var data = JSON.parse(this.responseText);
        //go to next function when data is received
        console.log('received')
          drawStandsButtons(data);

    }
};
//request data from database
  xmlhttp.open("GET", 'http://localhost:5000/request?type=staticlocations', true);
  xmlhttp.send();



}


function drawStandsButtons(data){

  var html ='<ul>';
  for (var stand in data){

html+='<li style="cursor:pointer" id="button'+stand.toString()+'" onclick="loadChart('+stand.toString()+', currentDay)">'+data[stand].name+'</li>'
}
  html+='</ul>'
  document.getElementById('standsList').innerHTML = html;

}

function loadChart(stand, day){
  document.getElementById('button'+currentStand.toString()).style.backgroundColor = 'white';
  document.getElementById('button'+stand.toString()).style.backgroundColor='deepskyblue';
  document.getElementById('dayButton'+currentDay.toString()).style.backgroundColor = 'white';
  document.getElementById('dayButton'+day.toString()).style.backgroundColor='deepskyblue';
  curentDay = day;
  currentStand = stand;
  console.log('getting chart information')
  var xmlhttp = new XMLHttpRequest();
  //get all data for drawing map markers
    xmlhttp.onreadystatechange = function() {

      if (this.readyState == 4 && this.status == 200) {

            var data = JSON.parse(this.responseText);
          //go to next function when data is received
          console.log('received')
            makeChart(data);

      }
  };
  //request data from database
    xmlhttp.open("GET", 'http://localhost:5000/graph?stand='+stand.toString()+'&day='+day.toString(), true);
    xmlhttp.send();





}

function makeChart(data){
  console.log(data.bikes)
  console.log(data.spaces)
  console.log('making chart')
  var labels = makeTimeLabels();
  new Chart(document.getElementById("chart"), {
  type: 'line',
  data: {
    labels: makeTimeLabels(),
    datasets: [{
        data: data.bikes,
        label: "Bikes",
        borderColor: "#3e95cd",
        fill: false
      }, {
        data: data.spaces,
        label: 'Spaces',
        borderColor: "#8e5ea2",
        fill: false
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: 'Average stand occupancy by hour'
    }
  }
});









}
function createDayBar(){
 document.getElementById('dayBar').innerHTML
  html='<div class="col-md-5"></div>'

  days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
  for (var i=0; i<7; i++){

html+='<div class="col-md-1" id="dayButton'+i.toString()+'" style="cursor:pointer" onclick="loadChart(currentStand, '+i.toString()+')">'+days[i]+'</div>';


  }

 document.getElementById('dayBar').innerHTML=html


}
var currentStand = 1
var currentDay = 1
createDayBar()
getStaticLocations()









</script>
</html>
